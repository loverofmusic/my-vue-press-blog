(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{472:function(t,a,e){"use strict";e.r(a);var v=e(5),r=Object(v.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h3",{attrs:{id:"浏览器缓存机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存机制"}},[t._v("#")]),t._v(" 浏览器缓存机制")]),t._v(" "),e("blockquote",[e("p",[t._v("首先明确一个问题，如果没有缓存，不仅浪费时间而且浪费带宽")])]),t._v(" "),e("h3",{attrs:{id:"思维导图："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#思维导图："}},[t._v("#")]),t._v(" 思维导图：")]),t._v(" "),e("p",[e("img",{attrs:{src:"/my-vue-press-blog/img/interview/cache_mind.jpeg",alt:"浏览器缓存机制-思维导图"}})]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("ol",[e("li",[t._v("根据是否需要"),e("code",[t._v("向服务器重新发起HTTP请求")]),t._v("将缓存过程分为两个部分，分别是"),e("code",[t._v("强缓存")]),t._v("和"),e("code",[t._v("协商缓存")])]),t._v(" "),e("li",[t._v("根据Cache-Control、Expires判断资源"),e("code",[t._v("是否过期")]),t._v("，即：是否需要"),e("code",[t._v("向服务器重新发起HTTP请求")]),t._v("，没有过期，就走"),e("code",[t._v("强缓存")]),t._v("，过期就走"),e("code",[t._v("协商缓存")])])])]),t._v(" "),e("h3",{attrs:{id:"强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),e("p",[e("code",[t._v("不会向服务器发送请求")]),t._v("，直接从缓存中读取资源，在chrome控制台的Network选项中可以看到该请求返回200的状态码，并且Size显示from disk cache或from memory cache。"),e("br"),t._v("\n强缓存可以通过设置两种 HTTP Header 实现：Expires 和 Cache-Control。")]),t._v(" "),e("blockquote",[e("p",[t._v("Expires 是http1.0的产物，Cache-Control是http1.1的产物，两者同时存在的话，Cache-Control优先级高于Expires；在某些不支持HTTP1.1的环境下，Expires就会发挥用处，现阶段它的存在只是一种兼容性的写法，同样还有一种pragma也只是一种兼容性的写法。")])]),t._v(" "),e("h3",{attrs:{id:"协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),e("p",[t._v("协商缓存就是强制缓存失效后，浏览器携带缓存标识"),e("code",[t._v("向服务器发起请求")]),t._v("，由服务器根据缓存标识决定是否使用缓存的过程，主要有以下两种情况：")]),t._v(" "),e("ul",[e("li",[t._v("协商缓存生效，返回304和Not Modified")])]),t._v(" "),e("ul",[e("li",[t._v("协商缓存失效，返回200和请求结果\n协商缓存可以通过设置两种 HTTP Header 实现：Last-Modified 和 ETag")])]),t._v(" "),e("h3",{attrs:{id:"流程图："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#流程图："}},[t._v("#")]),t._v(" 流程图：")]),t._v(" "),e("p",[e("img",{attrs:{src:"/my-vue-press-blog/img/interview/cache_diapragming.jpeg",alt:"浏览器缓存机制-流程图"}})]),t._v(" "),e("h3",{attrs:{id:"缓存标识cache-control可以设置的值-可以组合使用多种指令-："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缓存标识cache-control可以设置的值-可以组合使用多种指令-："}},[t._v("#")]),t._v(" 缓存标识Cache-Control可以设置的值(可以组合使用多种指令)：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("指令")]),t._v(" "),e("th",[t._v("作用")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("public")]),t._v(" "),e("td",[t._v("所有内容都将被缓存（客户端和代理服务器都可缓存）")])]),t._v(" "),e("tr",[e("td",[t._v("private")]),t._v(" "),e("td",[t._v("所有内容只有客户端可以缓存，Cache-Control的默认取值")])]),t._v(" "),e("tr",[e("td",[t._v("no-cache")]),t._v(" "),e("td",[t._v("客户端缓存内容，是否使用缓存则需要经过协商缓存来验证决定")])]),t._v(" "),e("tr",[e("td",[t._v("no-store")]),t._v(" "),e("td",[t._v("所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存")])]),t._v(" "),e("tr",[e("td",[t._v("max-age")]),t._v(" "),e("td",[t._v("max-age=xxx 表示缓存内容将在xxx秒后失效")])]),t._v(" "),e("tr",[e("td",[t._v("s-maxage")]),t._v(" "),e("td",[t._v("同max-age作用一样，只在代理服务器中生效（比如CDN缓存）")])])])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("no-cache这个名字有一点误导")]),t._v(" "),e("ol",[e("li",[t._v("表示不使用强缓存（ Cache-Control的缓存控制方式做前置验证），而是使用协商缓存（ Etag 或者Last-Modified字段来控制缓存）。")]),t._v(" "),e("li",[t._v("设置了no-cache之后，并不是说浏览器就不再缓存数据，只是浏览器在使用缓存数据时，需要先确认一下数据是否还"),e("code",[t._v("跟服务器保持一致")])])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[t._v("s-maxage的优先级高于max-age")])]),t._v(" "),e("blockquote",[e("p",[t._v("Cache-Control值设置的细节(可以组合使用多种指令)：")])]),t._v(" "),e("p",[e("img",{attrs:{src:"/my-vue-press-blog/img/interview/cache_control.jpeg",alt:"浏览器缓存机制-思维导图"}})]),t._v(" "),e("h3",{attrs:{id:"参考文章："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文章："}},[t._v("#")]),t._v(" 参考文章：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/28113197",target:"_blank",rel:"noopener noreferrer"}},[t._v("设计一个无懈可击的浏览器缓存方案：关于思路，细节，ServiceWorker，以及HTTP/2"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);